version: '3'

services:

  apache:
      build:
        context: ./
        dockerfile: Dockerfile
      working_dir: /app
      ports:
          - 80:80
          - 443:443
      volumes:
          - ./:/app
      links:
        - pgsql
        - mysql
        - redis
      environment:
          WEB_DOCUMENT_ROOT: /app/public
          WEB_DOCUMENT_INDEX: index.php
          REDIS_PORT: "6379"

  pgsql:
    image: postgres
    ports:
        - 5433:5432
    environment:
        POSTGRES_PASSWORD: ""
        POSTGRES_USER: pguser
        POSTGRES_DB: pgdb
    volumes:
      - .:/app

  mysql:
      ports:
          - 3307:3306
      image: mysql:5.7
      volumes:
          - ./:/app
      environment:
          MYSQL_ALLOW_EMPTY_PASSWORD: "yes"
          MYSQL_DATABASE: "mysqldb"

  redis:
      ports:
          - 6380:6379
      image: redis:3.2
      volumes:
          - ./:/app
